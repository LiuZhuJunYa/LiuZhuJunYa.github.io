---
title: SoK：理解 zk-SNARKs：研究与实践之间的差距
date: 2025-10-05
categories: 
  - 论文阅读
---

## 作者

<p style="text-align:center">Junkai Liang¹,，Daqi Hu¹,，Pengfei Wu²,*，Yunbo Yang³，Qingni Shen¹,†，Zhonghai Wu¹,†</p>
<p style="text-align:center">¹ 北京大学，² 新加坡管理大学，³ 华东师范大学</p>

## 摘要

零知识、简洁、非交互式的知识论证（zk-SNARK）作为一种强有力的技术，用于证明计算的正确性，并已引起研究人员的高度关注。学术界和工业界提出了大量具体方案与实现。不幸的是，zk-SNARK 的内在复杂性在研究人员、开发者与用户之间造成了差距，因为他们对这项技术的关注点并不相同。例如，研究人员致力于构建新的高效证明系统，使其具有更强的安全性和新的性质。与此同时，开发者与用户更关心实现所依赖的工具链、可用性与兼容性。这一差距阻碍了 zk-SNARK 领域的发展。

在这项工作中，我们对 zk-SNARK 从理论到实践进行了全面研究，明确指出其中的差距与局限。我们首先提出一个“总配方”，以统一将程序转换为 zk-SNARK 的主要步骤。随后，我们按照关键技术对现有的 zk-SNARK 进行分类。我们的分类刻画了现有 zk-SNARK 方案在具有实际价值的性质上的主要差异。我们调研了自 2013 年以来超过 40 种 zk-SNARK，并提供了一张参考表，列出其类别与性质。按照该“总配方”的步骤，我们进一步调研了 11 个通用且广泛使用的库，并详细阐述了这些库的可用性、兼容性、效率及其局限性。鉴于安装与运行这些 zk-SNARK 系统具有挑战，我们还提供了一个完全虚拟的环境，可在其中为每个系统运行其编译器。我们发现，在密码学学术界，证明系统是主要关注点；相对地，在工业界，约束系统形成了瓶颈。为弥合这一差距，我们提出了若干建议，并呼吁开源社区加强文档、标准化与兼容性建设。

## 1 引言

*设想你有一位红绿色盲的朋友，她怀疑红色和绿色其实并不是不同的颜色。你想向你的朋友证明这两种颜色确实不同。我们的问题是：在不泄露你所使用物体的真实颜色的前提下，你要如何做到这一点？*

上述“色盲验证者”[1] 是一个在用日常情境思考零知识证明（ZKP）时的经典问题。其解法也很容易理解：你为你的朋友准备一个红球和一个绿球，并让她选一个作为她的最爱。随后她把两只球都遮住，随机选出一个，问你它是不是她最喜欢的那个。如果红色和绿色确实不同，你可以以概率 1 成功；否则，你只能以概率 1/2 成功[3]。你的朋友可以重复这个过程，以使她相信“纯属巧合”的概率可以忽略不计。

对上述思想实验进行自然的形式化，会得到 ZKP 的一种交互式形式，在这种形式中，验证者与证明者之间有一轮或多轮交互[2]，也就是所谓的交互式证明（IP）。IP 是 ZKP 领域的一项突破，因为它被用来证明对所有属于非确定性多项式时间（NP）类问题的解的“知识”，从而把 ZKP 的能力从日常情境扩展到了计算模型[3]。IP 功能强大，但可能需要多轮交互，这会增加通信负担，并且对某些应用（例如区块链或保密机器学习）来说并不现实。非交互式零知识（NIZK）证明关注的是这样一类协议：证明者只向验证者发送一条消息（即证明），验证者据此决定是否接受。NIZK 的主要目的在于解决交互性带来的时延问题。幸运的是，可以通过通用的变换把 IP 与 NIZK 桥接起来，例如 Fiat–Shamir 变换[4]，它允许证明者生成哈希值，仿佛这些哈希值是由验证者给出的随机消息。沿着这些理论进展，已经有人提出了用于“三可着色问题”和“3-可满足性问题”的 IP 与 NIZK 协议[3,5]。然而，这些工作在渐近开销上很大，因而并不实用。为更好地应对真实世界场景，NIZK 还被进一步要求具备“简洁性”，也就是说证明者与验证者所用的时间与内存都是有界的。具备简洁性的 NIZK（亦即 zk-SNARK）已成为面向实际应用的 ZKP 研究主流。ZKP、NIZK 与 zk-SNARK 之间的关系见图 1。

<p style="text-align:center"><img src="./1.jpg" alt="bug"/></p>

<p style="text-align:center">图 1：ZKP、NIZK 与 zk-SNARK 的包含关系。</p>

源自 ZKP 和 NIZK，zk-SNARK 提供了一种机制，使不互信的一方能够证明自己对 NP 关系的知识，而生成的证明不泄露任何关于私有见证的信息。这一宝贵性质使 zk-SNARK 成为强大的密码学基元，使得在不暴露私有输入的情况下验证计算正确性成为可能。过去几年间，围绕 zk-SNARK 应用涌现出一波突破性的科学成果，范围包括但不限于金融服务（如区块链支付 [6,7,8]）、智能合约 [9,10]，以及机器学习 [11,12]、多方计算 [13,14,15] 和后量子密码学 [16,17] 等学术领域。zk-SNARK 还拥有可观的市场前景。迄今为止，基于 zk-SNARK 的、被广泛使用的区块链已有 10 余条，并有估计认为，到 2030 年仅用于生成 ZK 证明的交易费用就将达到 100 亿 [18]。除区块链服务外，Axiom [19]、FedML [20] 与 Giza [21] 等众多公司也在合作构建面向隐私保护型机器学习及其他应用的 ZK 生态系统。

尽管 zk-SNARK 具有很强的通用性、简洁性，并像加密与签名算法那样具备广泛应用的潜力，但研究与实践之间仍存在差距，阻碍了 zk-SNARK 的发展。研究者与从业者在 zk-SNARK 的三个概念上关注点不同：约束系统、证明系统与编译器。约束系统表示我们希望被证明的问题，例如某些具体的 NP 关系（如 3-可满足性）。证明系统表示生成该关系证明的具体密码学技术。编译器是将我们想要证明的高级程序转换为数学形式的约束系统的实用工具。

研究人员主要致力于为不同的约束系统设计不同的证明系统，以达到特定性质。迄今为止，已有一些方案具备非常实用的性质，例如常数大小的证明、线性复杂度的证明者、后量子安全性以及透明设置。然而，这些性质并未集成到同一个方案中，彼此之间存在取舍。要理解这些取舍，需要具备大量 zk-SNARK 的数学背景知识；从实务角度看，这相当艰难，致使从业者难以为其应用选择合适的方案。此外，对从业者而言，最耗时且最容易出错的环节在于使用编译器。正如文献 [22,23,24,25] 所报道的那样，程序员在正确实现自身的 zk-SNARK 应用方面屡屡受挫，并且由于误解编译器语言而产生了数以百计的漏洞。

我们在 zk-SNARK 领域识别出学术界与工业界视角之间的若干鸿沟：（1）用户在选择方案时需要专家级知识；（2）编译器的重要性被低估。为此，我们关注以下研究问题：

> **RQ1：** 如何给出一份统一的“总配方”，以梳理不同 zk-SNARK 背后的设计原则与优化？
> **RQ2：** 能否针对不同的真实场景提供选择 zk-SNARK 的指导？
> **RQ3：** 基于总配方与实验，并细致审视既有工作，我们能否为学术研究者与库的设计者提供新的洞见？

**我们的工作：** 为回答这些问题，我们对 zk-SNARK 及其库进行了系统性综述。首先，我们提出一份统一的总配方，用以勾勒主流 zk-SNARK 的设计原则。该配方包含关键步骤：将高级程序编译为电路，将电路交由证明系统以生成一个 IP（交互式证明），并应用通用变换以产生最终的 zk-SNARK。除此之外，我们还探讨 zk-SNARK 的主要应用，如保密区块链、零知识机器学习以及密码学用途。

依照总配方，我们对证明系统进行分类，并在各类别中追踪其演化。这有助于非专家用户选择合适的 zk-SNARK 方案。随后，我们基于性能与可用性评估了全部 11 个最先进的 zk-SNARK 库。通过性能分析，我们针对不同需求给出实现 zk-SNARK 的最佳实践建议。此外，我们识别出当前库中的常见问题，并呼吁改进文档与标准化。

我们强调，本论文及其开源材料面向四类读者：（1）希望通过理解最先进的库，从理论走向实践的研究人员；（2）希望将某个组件实现为 zk-SNARK 工具包的开发者；（3）希望实现自有 zk-SNARK 应用的程序员；以及（4）希望了解某个 zk-SNARK 应用是否满足自身需求的用户。我们认为这些工作是必要的，并能够促进实践者更好地利用 zk-SNARK 的成果。

**贡献概述：** 虽然我们并非首次综述该主题，但我们将本工作定位为首个对过去十年研究与实践进行系统化梳理的工作，着眼于借助最先进的库来应对新出现的挑战。概括而言，我们有五点主要贡献：

* 我们给出了一份统一的总配方，展示了一个高级程序如何从起点到终点被转换为 zk-SNARK。在该总配方之内，我们在第 3 节建立了一个全面综述，涵盖实际 zk-SNARK 中使用的不同电路、约束系统、技术与应用。
* 在总配方的指导下，我们进一步调研了 40 余种 zk-SNARK，并提供了证明系统的全面对比表；我们讨论了总配方与本次调查如何有助于弥合这些差距。
* 我们调研了全部 11 个 zk-SNARK 库，并基于性能与可用性进行比较；我们提出最佳实践的实现方案，并分析各库的架构、工具集与文档。
* 我们在 Docker 容器中提供了精心设计的测试代码示例；我们相信这将有助于 zk-SNARK 开源社区的发展，并帮助用户利用 zk-SNARK 领域的成果。我们所有代码与文档已发布在永久仓库，获取地址为：https://doi.org/10.5281/zenodo.14682405。
* 基于全面分析，我们从三个视角给出关键洞见与建议：面向非专家的库选择与编程指南、研究者的未来方向，以及对库设计者的建议。

**相关工作：** 以往关于 ZKP 的综述大体分为两类。**其一**，关于 zk-SNARK 的构造与理论应用的综述。例如，Feng 和 Mcllin【26】介绍了 zk-SNARK 的基础及其在 NP 计算中的用法；Nituslescu【27】聚焦于基于二次算术程序（QAP）的 zk-SNARK；Li 等【28】按技术对 zk-SNARK 进行分类，但更关注诸如约束系统和分层电路等小众实现。也有其他工作【29，30】讨论范围证明并提供实践性建议。然而，这些工作只覆盖了 zk-SNARK 的一小部分，而且主要偏学术性。与之相对，我们的工作贯通理论与实践，提供更广泛的洞见。**其二**，关于实际 zk-SNARK 实现中漏洞的综述。既有研究强调了电路层【23，31，32】、编译阶段【24】以及面向具体应用的完整性层【33，34】存在的问题；Chaliasos 等【25】对这些漏洞作了全面总结。我们的工作不同之处在于，为 zk-SNARK 实践者提供一份全面的操作指引，并着重可用性、效率、兼容性与库的选择，旨在在强调软件安全的同时，减少对密码学不熟悉的实践者出现错误。

<p style="text-align:center">表 1：缩写及对应全称</p>

| 缩写     | 全称                                                         |
| -------- | ------------------------------------------------------------ |
| AIR      | 算术中间表示（Arithmetic Intermediate Representation）       |
| CRS      | 公共参考字符串（Common Reference String）                    |
| DEIP     | 双重高效交互式证明（Doubly Efficient Interactive Proofs）    |
| (e)DSL   | （嵌入式）领域特定语言（(embedded) Domain-Specific Language） |
| FFT      | 快速傅里叶变换（Fast Fourier Transform）                     |
| FRI      | 快速 Reed–Solomon 邻近性 IOP（Fast Reed–Solomon IOP of Proximity） |
| HDL      | 硬件描述语言（Hardware Description Language）                |
| I(O)P    | 交互式（预言机）证明（Interactive (Oracle) Proof）           |
| IPA      | 内积论证（Inner Product Argument）                           |
| ITP      | 信息论证明（Information-Theoretic Proof）                    |
| MPC      | 多方计算（Multi-Party Computation）                          |
| NIZK     | 非交互式零知识（Non-Interactive Zero-Knowledge）             |
| NP       | 非确定性多项式时间（Non-deterministic Polynomial Time）      |
| PL       | 编程语言（Programming Language）                             |
| (L)PCP   | （线性）概率可检验证明（(Linear) Probabilistically Checkable Proof） |
| PCS      | 多项式承诺方案（Polynomial Commitment Scheme）               |
| PIOP     | 多项式交互式预言机证明（Polynomial Interactive Oracle Proof） |
| QAP      | 二次算术程序（Quadratic Arithmetic Program）                 |
| QSP      | 二次跨度（张成）程序（Quadratic Span Program）               |
| R1CS     | 秩-1 约束系统（Rank-1 Constraint System）                    |
| STARK    | 可扩展透明的知识论证（Scalable Transparent ARguments of Knowledge） |
| ZKP      | 零知识证明（Zero-Knowledge Proof）                           |
| ZKML     | 零知识机器学习（Zero-Knowledge Machine Learning）            |
| zk-SNARK | 零知识、简洁、非交互式知识论证（Zero-Knowledge Succinct Non-Interactive Argument of Knowledge） |
| zk-VM    | 零知识虚拟机（Zero-Knowledge Virtual Machine）               |
